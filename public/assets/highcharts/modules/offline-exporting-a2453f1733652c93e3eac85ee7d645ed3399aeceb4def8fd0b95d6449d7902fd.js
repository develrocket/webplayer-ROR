!function(t){t.CanVGRenderer={},t.Chart.prototype.exportChartLocal=function(e,n){function o(t,e){++p,e.imageElement.setAttributeNS("http://www.w3.org/1999/xlink","href",t),p===a.length&&x()}var r,a,i,c,g,h=this,l=t.merge(h.options.exporting,e),s=navigator.userAgent.indexOf("WebKit")>-1&&navigator.userAgent.indexOf("Chrome")<0,d=l.scale||2,m=window.URL||window.webkitURL||window,p=0,u=function(){if(l.fallbackToExportServer===!1)throw"Fallback to export server disabled";h.exportChart(l)},f=function(t,e,n,o,r,a,i){var c=new Image;s||(c.crossOrigin="Anonymous"),c.onload=function(){var a,g=document.createElement("canvas"),h=g.getContext&&g.getContext("2d");if(h){g.height=c.height*d,g.width=c.width*d,h.drawImage(c,0,0,g.width,g.height);try{a=g.toDataURL(),n(a,e)}catch(l){if("SecurityError"!==l.name&&"SECURITY_ERR"!==l.name&&"SecurityError"!==l.message)throw l;o(t,e)}}else r(t,e);i&&i(t,e)},c.onerror=function(){a(t,e),i&&i(t,e)},c.src=t},w=function(t){try{if(!s&&navigator.userAgent.toLowerCase().indexOf("firefox")<0)return m.createObjectURL(new Blob([t],{type:"image/svg+xml;charset-utf-16"}))}catch(e){}return"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(t)},v=function(t,e){var n,o=document.createElement("a"),r=(l.filename||"chart")+"."+e;if(navigator.msSaveOrOpenBlob)return void navigator.msSaveOrOpenBlob(t,r);if("undefined"!=typeof o.download)o.href=t,o.download=r,o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o);else try{if(n=window.open(t,"chart"),"undefined"==typeof n||null===n)throw 1}catch(a){window.location.href=t}},x=function(){var e,n,o=h.sanitizeSVG(r.innerHTML);if(l&&"image/svg+xml"===l.type)try{navigator.msSaveOrOpenBlob?(n=new MSBlobBuilder,n.append(o),e=n.getBlob("image/svg+xml")):e=w(o),v(e,"svg")}catch(a){u()}else e=w(o),f(e,{},function(t){try{v(t,"png")}catch(e){u()}},function(){var e=document.createElement("canvas"),n=e.getContext("2d"),r=o.match(/^<svg[^>]*width\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*d,a=o.match(/^<svg[^>]*height\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*d,i=function(){n.drawSvg(o,0,0,r,a);try{v(navigator.msSaveOrOpenBlob?e.msToBlob():e.toDataURL("image/png"),"png")}catch(t){u()}};e.width=r,e.height=a,window.canvg?i():(h.showLoading(),HighchartsAdapter.getScript(t.getOptions().global.canvasToolsURL,function(){h.hideLoading(),i()}))},u,u,function(){try{m.revokeObjectURL(e)}catch(t){}})};t.wrap(t.Chart.prototype,"getChartHTML",function(t){return r=this.container.cloneNode(!0),t.apply(this,Array.prototype.slice.call(arguments,1))}),h.getSVGForExport(l,n),a=r.getElementsByTagName("image");try{for(a.length||x(),c=0,g=a.length;g>c;++c)i=a[c],f(i.getAttributeNS("http://www.w3.org/1999/xlink","href"),{imageElement:i},o,u,u,u)}catch(y){u()}},t.getOptions().exporting.buttons.contextButton.menuItems=[{textKey:"printChart",onclick:function(){this.print()}},{separator:!0},{textKey:"downloadPNG",onclick:function(){this.exportChartLocal()}},{textKey:"downloadSVG",onclick:function(){this.exportChartLocal({type:"image/svg+xml"})}}]}(Highcharts);