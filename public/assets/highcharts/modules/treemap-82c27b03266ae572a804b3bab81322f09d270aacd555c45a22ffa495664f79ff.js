!function(t){var i=t.seriesTypes,e=t.map,n=t.merge,o=t.extend,l=t.extendClass,r=t.getOptions(),s=r.plotOptions,a=function(){},h=t.each,d=HighchartsAdapter.grep,c=t.pick,p=t.Series,u=t.Color,f=function(t,i,e){var n;e=e||this;for(n in t)t.hasOwnProperty(n)&&i.call(e,t[n],n,t)},v=function(t,i,e,n){return n=n||this,t=t||[],h(t,function(o,l){e=i.call(n,e,o,l,t)}),e},g=function(t,i,e){var n;e=e||this,n=i.call(e,t),n!==!1&&g(n,i,e)};s.treemap=n(s.scatter,{showInLegend:!1,marker:!1,borderColor:"#E0E0E0",borderWidth:1,dataLabels:{enabled:!0,defer:!1,verticalAlign:"middle",formatter:function(){return this.point.name||this.point.id},inside:!0},tooltip:{headerFormat:"",pointFormat:"<b>{point.name}</b>: {point.node.val}</b><br/>"},layoutAlgorithm:"sliceAndDice",layoutStartingDirection:"vertical",alternateStartingDirection:!1,levelIsConstant:!0,states:{hover:{borderColor:"#A0A0A0",brightness:i.heatmap?0:.1,shadow:!1}},drillUpButton:{position:{align:"left",x:10,y:-50}}});var y={pointAttrToOptions:{},pointArrayMap:["value"],axisTypes:i.heatmap?["xAxis","yAxis","colorAxis"]:["xAxis","yAxis"],optionalAxis:"colorAxis",getSymbol:a,parallelArrays:["x","y","value","colorValue"],colorKey:"colorValue",translateColors:i.heatmap&&i.heatmap.prototype.translateColors};i.treemap=l(i.scatter,n(y,{type:"treemap",trackerGroups:["group","dataLabelsGroup"],pointClass:l(t.Point,{setVisible:i.pie.prototype.pointClass.prototype.setVisible}),getListOfParents:function(t,i){var e=v(t,function(t,i,e){var n=c(i.parent,"");return void 0===t[n]&&(t[n]=[]),t[n].push(e),t},{});return f(e,function(t,e,n){""!==e&&-1===HighchartsAdapter.inArray(e,i)&&(h(t,function(t){n[""].push(t)}),delete n[e])}),e},getTree:function(){var t,i=this,n=e(this.data,function(t){return t.id}),o=i.getListOfParents(this.data,n);return i.nodeMap=[],t=i.buildNode("",-1,0,o,null),g(this.nodeMap[this.rootNode],function(t){var e=!1,n=t.parent;return t.visible=!0,(n||""===n)&&(e=i.nodeMap[n]),e}),g(this.nodeMap[this.rootNode].children,function(t){var i=!1;return h(t,function(t){t.visible=!0,t.children.length&&(i=(i||[]).concat(t.children))}),i}),this.setTreeValues(t),t},init:function(t,i){var e=this;p.prototype.init.call(e,t,i),e.options.allowDrillToNode&&e.drillTo()},buildNode:function(t,i,e,n,o){var l,r,s=this,a=[],d=s.points[i];return h(n[t]||[],function(i){r=s.buildNode(s.points[i].id,i,e+1,n,t),a.push(r)}),l={id:t,i:i,children:a,level:e,parent:o,visible:!1},s.nodeMap[l.id]=l,d&&(d.node=l),l},setTreeValues:function(t){var i,e=this,n=e.options,l=0,r=[],s=e.points[t.i];return h(t.children,function(t){t=e.setTreeValues(t),e.insertElementSorted(r,t,function(t,i){return t.val>i.val}),t.ignore?g(t.children,function(t){var i=!1;return h(t,function(t){o(t,{ignore:!0,isLeaf:!1,visible:!1}),t.children.length&&(i=(i||[]).concat(t.children))}),i}):l+=t.val}),i=c(s&&s.value,l),o(t,{children:r,childrenTotal:l,ignore:!(c(s&&s.visible,!0)&&i>0),isLeaf:t.visible&&!l,levelDynamic:n.levelIsConstant?t.level:t.level-e.nodeMap[e.rootNode].level,name:c(s&&s.name,""),val:i}),t},calculateChildrenAreas:function(t,i){var e,o=this,l=o.options,r=this.levelMap[t.levelDynamic+1],s=c(o[r&&r.layoutAlgorithm]&&r.layoutAlgorithm,l.layoutAlgorithm),a=l.alternateStartingDirection,p=[];e=d(t.children,function(t){return!t.ignore}),r&&r.layoutStartingDirection&&(i.direction="vertical"===r.layoutStartingDirection?0:1),p=o[s](i,e),h(e,function(t,e){var l=p[e];t.values=n(l,{val:t.childrenTotal,direction:a?1-i.direction:i.direction}),t.pointValues=n(l,{x:l.x/o.axisRatio,width:l.width/o.axisRatio}),t.children.length&&o.calculateChildrenAreas(t,t.values)})},setPointValues:function(){var t=this,i=t.xAxis,e=t.yAxis;h(t.points,function(t){var n,o,l,r,s=t.node,a=s.pointValues;a?(n=Math.round(i.translate(a.x,0,0,0,1)),o=Math.round(i.translate(a.x+a.width,0,0,0,1)),l=Math.round(e.translate(a.y,0,0,0,1)),r=Math.round(e.translate(a.y+a.height,0,0,0,1)),t.shapeType="rect",t.shapeArgs={x:Math.min(n,o),y:Math.min(l,r),width:Math.abs(o-n),height:Math.abs(r-l)},t.plotX=t.shapeArgs.x+t.shapeArgs.width/2,t.plotY=t.shapeArgs.y+t.shapeArgs.height/2):(delete t.plotX,delete t.plotY)})},setColorRecursive:function(t,i){var e,n,o=this;t&&(e=o.points[t.i],n=o.levelMap[t.levelDynamic],i=c(e&&e.options.color,n&&n.color,i),e&&(e.color=i),t.children.length&&h(t.children,function(t){o.setColorRecursive(t,i)}))},alg_func_group:function(t,i,e,n){this.height=t,this.width=i,this.plot=n,this.direction=e,this.startDirection=e,this.total=0,this.nW=0,this.lW=0,this.nH=0,this.lH=0,this.elArr=[],this.lP={total:0,lH:0,nH:0,lW:0,nW:0,nR:0,lR:0,aspectRatio:function(t,i){return Math.max(t/i,i/t)}},this.addElement=function(t){this.lP.total=this.elArr[this.elArr.length-1],this.total=this.total+t,0===this.direction?(this.lW=this.nW,this.lP.lH=this.lP.total/this.lW,this.lP.lR=this.lP.aspectRatio(this.lW,this.lP.lH),this.nW=this.total/this.height,this.lP.nH=this.lP.total/this.nW,this.lP.nR=this.lP.aspectRatio(this.nW,this.lP.nH)):(this.lH=this.nH,this.lP.lW=this.lP.total/this.lH,this.lP.lR=this.lP.aspectRatio(this.lP.lW,this.lH),this.nH=this.total/this.width,this.lP.nW=this.lP.total/this.nH,this.lP.nR=this.lP.aspectRatio(this.lP.nW,this.nH)),this.elArr.push(t)},this.reset=function(){this.nW=0,this.lW=0,this.elArr=[],this.total=0}},alg_func_calcPoints:function(t,i,e,n){var o,l,r,s,a,d=e.lW,c=e.lH,p=e.plot,u=0,f=e.elArr.length-1;i?(d=e.nW,c=e.nH):a=e.elArr[e.elArr.length-1],h(e.elArr,function(t){(i||f>u)&&(0===e.direction?(o=p.x,l=p.y,r=d,s=t/r):(o=p.x,l=p.y,s=c,r=t/s),n.push({x:o,y:l,width:r,height:s}),0===e.direction?p.y=p.y+s:p.x=p.x+r),u+=1}),e.reset(),0===e.direction?e.width=e.width-d:e.height=e.height-c,p.y=p.parent.y+(p.parent.height-e.height),p.x=p.parent.x+(p.parent.width-e.width),t&&(e.direction=1-e.direction),i||e.addElement(a)},alg_func_lowAspectRatio:function(t,i,e){var n,o=[],l=this,r={x:i.x,y:i.y,parent:i},s=i.direction,a=0,d=e.length-1,c=new this.alg_func_group(i.height,i.width,s,r);return h(e,function(e){n=i.width*i.height*(e.val/i.val),c.addElement(n),c.lP.nR>c.lP.lR&&l.alg_func_calcPoints(t,!1,c,o,r),a===d&&l.alg_func_calcPoints(t,!0,c,o,r),a+=1}),o},alg_func_fill:function(t,i,e){var n,o,l,r,s,a=[],d=i.direction,c=i.x,p=i.y,u=i.width,f=i.height;return h(e,function(e){n=i.width*i.height*(e.val/i.val),o=c,l=p,0===d?(s=f,r=n/s,u-=r,c+=r):(r=u,s=n/r,f-=s,p+=s),a.push({x:o,y:l,width:r,height:s}),t&&(d=1-d)}),a},strip:function(t,i){return this.alg_func_lowAspectRatio(!1,t,i)},squarified:function(t,i){return this.alg_func_lowAspectRatio(!0,t,i)},sliceAndDice:function(t,i){return this.alg_func_fill(!0,t,i)},stripes:function(t,i){return this.alg_func_fill(!1,t,i)},translate:function(){var t,i,e,o;p.prototype.translate.call(this),this.points.length&&(this.rootNode=c(this.options.rootId,""),this.levelMap=v(this.options.levels,function(t,i){return t[i.level]=i,t},{}),e=this.tree=this.getTree(),this.axisRatio=this.xAxis.len/this.yAxis.len,this.nodeMap[""].pointValues=t={x:0,y:0,width:100,height:100},this.nodeMap[""].values=i=n(t,{width:t.width*this.axisRatio,direction:"vertical"===this.options.layoutStartingDirection?0:1,val:e.val}),this.calculateChildrenAreas(e,i)),this.colorAxis?this.translateColors():this.options.colorByPoint||this.setColorRecursive(this.tree,void 0),o=this.nodeMap[this.rootNode].pointValues,this.xAxis.setExtremes(o.x,o.x+o.width,!1),this.yAxis.setExtremes(o.y,o.y+o.height,!1),this.xAxis.setScale(),this.yAxis.setScale(),this.setPointValues()},drawDataLabels:function(){var t,i,e=this,o=d(e.points,function(t){return t.node.visible});h(o,function(o){i=e.levelMap[o.node.levelDynamic],t={style:{}},o.node.isLeaf||(t.enabled=!1),i&&i.dataLabels&&(t=n(t,i.dataLabels),e._hasPointLabels=!0),o.shapeArgs&&(t.style.width=o.shapeArgs.width),o.dlOptions=n(t,o.options.dataLabels)}),p.prototype.drawDataLabels.call(this)},alignDataLabel:i.column.prototype.alignDataLabel,pointAttribs:function(t,i){var e,n=this.levelMap[t.node.levelDynamic]||{},o=this.options,l=i&&o.states[i]||{};return e={stroke:t.borderColor||n.borderColor||l.borderColor||o.borderColor,"stroke-width":c(t.borderWidth,n.borderWidth,l.borderWidth,o.borderWidth),dashstyle:t.borderDashStyle||n.borderDashStyle||l.borderDashStyle||o.borderDashStyle,fill:t.color||this.color},"hover"===i&&(e.zIndex=1),t.node.level<=this.nodeMap[this.rootNode].level?(e.fill="none",e["stroke-width"]=0):t.node.isLeaf?i&&(e.fill=u(e.fill).brighten(l.brightness).get()):e.fill=c(o.interactByLeaf,!o.allowDrillToNode)?"none":u(e.fill).setOpacity("hover"===i?.75:.15).get(),e},drawPoints:function(){var t=this,e=d(t.points,function(t){return t.node.visible});h(e,function(i){var e="levelGroup-"+i.node.levelDynamic;t[e]||(t[e]=t.chart.renderer.g(e).attr({zIndex:1e3-i.node.levelDynamic}).add(t.group)),i.group=t[e],i.pointAttr={"":t.pointAttribs(i),hover:t.pointAttribs(i,"hover"),select:{}}}),i.column.prototype.drawPoints.call(this),t.options.allowDrillToNode&&h(e,function(i){var e,n;i.graphic&&(n=i.drillId=t.options.interactByLeaf?t.drillToByLeaf(i):t.drillToByGroup(i),e=n?"pointer":"default",i.graphic.css({cursor:e}))})},insertElementSorted:function(t,i,e){var n=0,o=!1;0!==t.length&&h(t,function(l){e(i,l)&&!o&&(t.splice(n,0,i),o=!0),n+=1}),o||t.push(i)},drillTo:function(){var i=this;t.addEvent(i,"click",function(t){var e,n=t.point,o=n.drillId;o&&(e=i.nodeMap[i.rootNode].name||i.rootNode,n.setState(""),i.drillToNode(o),i.showDrillUpButton(e))})},drillToByGroup:function(t){var i=this,e=!1;return t.node.level-i.nodeMap[i.rootNode].level!==1||t.node.isLeaf||(e=t.id),e},drillToByLeaf:function(t){var i,e=this,n=!1;if(t.node.parent!==e.rootNode&&t.node.isLeaf)for(i=t.node;!n;)i=e.nodeMap[i.parent],i.parent===e.rootNode&&(n=i.id);return n},drillUp:function(){var t,i,e=null;this.rootNode&&(t=this.nodeMap[this.rootNode],e=null!==t.parent?this.nodeMap[t.parent]:this.nodeMap[""]),null!==e&&(this.drillToNode(e.id),""===e.id?this.drillUpButton=this.drillUpButton.destroy():(i=this.nodeMap[e.parent],this.showDrillUpButton(i.name||i.id)))},drillToNode:function(t){this.options.rootId=t,this.isDirty=!0,this.chart.redraw()},showDrillUpButton:function(t){var i,e,n=this,o=t||"< Back",l=n.options.drillUpButton;l.text&&(o=l.text),this.drillUpButton?this.drillUpButton.attr({text:o}).align():(i=l.theme,e=i&&i.states,this.drillUpButton=this.chart.renderer.button(o,null,null,function(){n.drillUp()},i,e&&e.hover,e&&e.select).attr({align:l.position.align,zIndex:9}).add().align(l.position,!1,l.relativeTo||"plotBox"))},buildKDTree:a,drawLegendSymbol:t.LegendSymbolMixin.drawRectangle,getExtremes:function(){p.prototype.getExtremes.call(this,this.colorValueData),this.valueMin=this.dataMin,this.valueMax=this.dataMax,p.prototype.getExtremes.call(this)},getExtremesFromAll:!0,bindAxes:function(){var i={endOnTick:!1,gridLineWidth:0,lineWidth:0,min:0,dataMin:0,minPadding:0,max:100,dataMax:100,maxPadding:0,startOnTick:!1,title:null,tickPositions:[]};p.prototype.bindAxes.call(this),t.extend(this.yAxis.options,i),t.extend(this.xAxis.options,i)}}))}(Highcharts);