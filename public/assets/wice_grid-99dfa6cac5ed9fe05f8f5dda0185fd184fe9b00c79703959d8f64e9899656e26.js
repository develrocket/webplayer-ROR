(function(){var e;e=function(){function e(e,t,r,n,i,o,a){this.name=e,this.baseRequestForFilter=t,this.baseLinkForShowAllRecords=r,this.linkForExport=n,this.parameterNameForQueryLoading=i,this.parameterNameForFocus=o,this.environment=a,this.filterDeclarations=new Array,this.checkIfJsFrameworkIsLoaded()}return e.prototype.checkIfJsFrameworkIsLoaded=function(){return jQuery?void 0:alert("jQuery not loaded, WiceGrid cannot proceed!")},e.prototype.toString=function(){return"<WiceGridProcessor instance for grid '"+this.name+"'>"},e.prototype.process=function(e){return this.visit(this.buildUrlWithParams(e))},e.prototype.visit=function(e){return"undefined"!=typeof Turbolinks&&null!==Turbolinks?Turbolinks.visit(e):window.location=e},e.prototype.setProcessTimer=function(e){var t;return this.timer&&(clearTimeout(this.timer),this.timer=null),t=this,this.timer=setTimeout(function(){return t.process(e)},1e3)},e.prototype.reloadPageForGivenGridState=function(e){var t;return t=this.gridStateToRequest(e),this.visit(this.appendToUrl(this.baseLinkForShowAllRecords,t))},e.prototype.gridStateToRequest=function(e){return jQuery.map(e,function(e){return encodeURIComponent(e[0])+"="+encodeURIComponent(e[1])}).join("&")},e.prototype.appendToUrl=function(e,t){var r;return r=-1!==e.indexOf("?")?/[&\?]$/.exec(e)?"":"&":"?",e+r+t},e.prototype.buildUrlWithParams=function(e){var t,r,n;return n=new Array,jQuery.each(this.filterDeclarations,function(e){return function(t,r){var i;return i=e.readValuesAndFormQueryString(r.filterName,r.detached,r.templates,r.ids),i&&""!==i?n.push(i):void 0}}(this)),r=this.baseRequestForFilter,0!==n.length&&(t=n.join("&"),r=this.appendToUrl(r,t)),e&&(r=this.appendToUrl(r,this.parameterNameForFocus+e)),r},e.prototype.reset=function(){return this.visit(this.baseRequestForFilter)},e.prototype.exportToCsv=function(){return this.visit(this.linkForExport)},e.prototype.register=function(e){return this.filterDeclarations.push(e)},e.prototype.readValuesAndFormQueryString=function(e,t,r,n){var i,o,a,c,u,d,s,l,p,f;for(p=new Array,o=c=0,s=r.length-1;s>=0?s>=c:c>=s;o=s>=0?++c:--c){if(null===$(n[o]))return"development"===this.environment&&(d='WiceGrid: Error reading state of filter "'+e+'". No DOM element with id "'+n[o]+'" found.',t&&(d+='You have declared "'+e+'" as a detached filter but have not output it anywhere in the template. Read documentation about detached filters.'),alert(d)),"";if(i=$("#"+n[o]),i[0]&&"checkbox"===i[0].type?i[0].checked&&(f=1):f=i.val(),f instanceof Array)for(a=u=0,l=f.length-1;l>=0?l>=u:u>=l;a=l>=0?++u:--u)f[a]&&""!==f[a]&&p.push(r[o]+encodeURIComponent(f[a]));else f&&""!==f&&p.push(r[o]+encodeURIComponent(f))}return p.join("&")},e}(),e._version="3.4",window.WiceGridProcessor=e}).call(this),function(){var e,t,r,n,i,o,a,c,u,d,s,l,p,f,h,v,g,k,m;$(document).on("page:load ready",function(){return n()}),r="wiceGrids",n=function(){return $(".wice-grid-container").each(function(t,n){var i,o,a,u,l,p,f,v,w;for(l=n.id,i=$(".wg-data",n),w=i.data("processor-initializer-arguments"),a=i.data("filter-declarations"),e(i.data("foc")),p=new WiceGridProcessor(l,w[0],w[1],w[2],w[3],w[4],w[5]),u=function(e){return null!=e?p.register({filterName:e.filterName,detached:e.detached,templates:e.declaration.templates,ids:e.declaration.ids}):void 0},f=0,v=a.length;v>f;f++)o=a[f],u(o);return window[r]||(window[r]={}),window[r][l]=p,m(n,p),s(n,p),h(n),k(n,p),g(n),c(n,p),d(n)}),a(),f(),p(),l(),g($(".wg-detached-filter"))},o=function(e,t,r,n,i){var o,a,c,u;return(a=t.data(e))&&(u=$(o="#"+a))&&(c=u.datepicker("getDate"))&&i(c,r)?(u.datepicker("setDate",r),u.next().next().html($.datepicker.formatDate(n,r))):void 0},l=function(){return 0!==$(".date-filter.wg-jquery-datepicker").length&&v(),0!==$(".date-filter.wg-bootstrap-datepicker").length?u():void 0},u=function(){return $.fn.datepicker?$(".date-filter.wg-bootstrap-datepicker input:text[data-provide=datepicker]").each(function(e,t){return $(t).datepicker().on("hide",function(e){var t,r,n;return t=$(e.currentTarget),n=t.data("close-calendar-event-name"),n?t.trigger(n):"fr"===t.attr("id").split("_").pop()&&(r=t.parent().next().find("input:text.check-for-bsdatepicker"),r.length>0)?r.datepicker("show"):void 0})}):void alert("Seems like you do not have Bootstrap datepicker gem (https://github.com/Nerian/bootstrap-datepicker-rails)\ninstalled. Either install it pick another filter with :filter_type.")},v=function(){var e;return $.datepicker||alert("Seems like you do not have jQuery datepicker (http://jqueryui.com/demos/datepicker/)\ninstalled. Either install it pick another filter with :filter_type."),(e=$(".date-filter.wg-jquery-datepicker input[type=hidden]").data("locale"))&&$.datepicker.setDefaults($.datepicker.regional[e]),$(".date-filter.wg-jquery-datepicker .date-label").each(function(e,t){var r,n,i,a,c,u,d,s;return i=$("#"+$(t).data("dom-id")),a=i.data("close-calendar-event-name"),$(t).click(function(e){return $(this).html(""),i.val(""),a&&i.trigger(a),e.preventDefault(),!1}),d=this,r=i.data("date-format"),s=i.data("date-year-range"),c=i.data("button-text"),i.datepicker({firstDay:1,dateFormat:r,changeMonth:!0,changeYear:!0,yearRange:s,onSelect:function(e,t){var n;return n=$(this).datepicker("getDate"),o("the-other-datepicker-id-to",i,n,r,function(e,t){return t>e}),o("the-other-datepicker-id-from",i,n,r,function(e,t){return e>t}),$(d).html(e),a?i.trigger(a):void 0}}),n=i.parent(),$(t).before(' <i class="fa fa-calendar ui-datepicker-trigger" title="'+c+'" ></i> '),u=$(".fa-calendar",n),u.click(function(){return i.datepicker("show")})})},h=function(e){var t,r,n;return r=".wg-hide-filter",n=".wg-show-filter",t=".wg-filter-row",$(r,e).click(function(){return $(this).hide(),$(n,e).show(),$(t,e).hide()}),$(n,e).click(function(){return $(this).hide(),$(r,e).show(),$(t,e).show()})},s=function(e,t){return $(".export-to-csv-button",e).click(function(){return t.exportToCsv()})},m=function(e,t){return $(".submit",e).click(function(){return t.process()}),$(".reset",e).click(function(){return t.reset()}),$(".wg-filter-row input[type=text], .wg-filter-row input:text[data-provide=datepicker]",e).keydown(function(e){return 13===e.keyCode?(e.preventDefault(),t.process()):void 0})},e=function(e){var t,r;return r=$("#"+e),(t=r[0])?(t.value=t.value,t.focus()):void 0},c=function(e,t){return $("select.auto-reload, input.native-datepicker.auto-reload",e).change(function(){return t.process()}),$("input.auto-reload",e).keyup(function(e){return i(e.which)?t.setProcessTimer(this.id):void 0}),$("input.negation-checkbox.auto-reload",e).click(function(){return t.process()}),$(document).bind("wg:calendarChanged_"+t.name,function(){return t.process()})},i=function(e,t){return-1===[37,38,39,40,9,27].indexOf(e)},a=function(){return $(".wg-detached-filter").each(function(e,r){var n;return n=t(r),n?($("select.auto-reload, input.native-datepicker.auto-reload",r).change(function(){return n.process()}),$("input.auto-reload",r).keyup(function(e){return i(e.which)?n.setProcessTimer(this.id):void 0}),$("input.negation-checkbox.auto-reload",r).click(function(){return n.process()})):void 0})},k=function(e,t){return $(".wg-show-all-link, .wg-back-to-pagination-link",e).click(function(e){var r,n,i;return e.preventDefault(),n=$(this).data("grid-state"),r=$(this).data("confim-message"),i=function(){return t.reloadPageForGivenGridState(n)},r?confirm(r)?i():void 0:i()})},g=function(e){return $(".expand-multi-select-icon",e).click(function(){return $(this).prev().each(function(e,t){return t.multiple=!0}),$(this).next().show(),$(this).hide()}),$(".collapse-multi-select-icon",e).click(function(){return $(this).prev().prev().each(function(e,t){return t.multiple=!1}),$(this).prev().show(),$(this).hide()})},d=function(e){return $(".select-all",e).click(function(){return $(".sel input",e).prop("checked",!0).trigger("change")}),$(".deselect-all",e).click(function(){return $(".sel input",e).prop("checked",!1).trigger("change")}),$(".wg-select-all",e).click(function(){return $(".sel input",e).prop("checked",$(this).prop("checked")).trigger("change")})},t=function(e){var t;return t=$(e).data("grid-name"),t&&window[r]?window[r][t]:null},p=function(){return $(".wg-external-csv-export-button").each(function(e,r){var n;return n=t(r),n?$(r).click(function(e){return n.exportToCsv()}):void 0})},f=function(){return $(".wg-external-submit-button").each(function(e,r){var n;return n=t(r),n?$(r).click(function(e){return n.process(),e.preventDefault(),!1}):void 0}),$(".wg-external-reset-button").each(function(e,r){var n;return n=t(r),n?$(r).click(function(e){return n.reset(),e.preventDefault(),!1}):void 0}),$(".wg-detached-filter").each(function(e,r){var n;return n=t(r),n?$("input[type=text], input:text[data-provide=datepicker]",this).keydown(function(e){return 13===e.keyCode?(n.process(),e.preventDefault(),!1):void 0}):void 0})},window.getGridProcessorForElement=t,window.initWiceGrid=n}.call(this),function(){var e,t,r,n,i;$(document).on("page:load ready",function(){return i()}),i=function(){return $(".wice-grid-save-query-field").keydown(function(e){return 13===e.keyCode?n($(this).next(),e):void 0}),$(".wice-grid-save-query-button").click(function(e){return n(this,e)}),$(".wice-grid-delete-query").click(function(t){return e(this,t)}),$(".wice-grid-query-load-link").click(function(e){return t(this,e)})},t=function(e,t){var r,n,i;return(r=window.getGridProcessorForElement(e))&&(n=$(e).data("query-id"),i=r.appendToUrl(r.buildUrlWithParams(),r.parameterNameForQueryLoading+encodeURIComponent(n)),r.visit(i)),t.preventDefault(),t.stopPropagation(),!1},e=function(e,t){var n,i,o;return n=$(e).data("wg-confirm"),o=n?function(){return confirm(n)}:function(){return!0},o()&&(i=window.getGridProcessorForElement(e))&&jQuery.ajax({url:$(e).attr("href"),async:!0,dataType:"json",success:function(e,t,n){return r(e,i.name)},type:"POST"}),t.preventDefault(),t.stopPropagation(),!1},n=function(e,t){var n,i,o,a,c,u,d,s;return(o=window.getGridProcessorForElement(e))?(n=$(e),i=n.data("base-path-to-query-controller"),a=n.data("parameters"),u=n.data("ids"),c=n.prev(),u instanceof Array&&u.each(function(e){return a.push(["extra["+e+"]",$("#"+e).val()])}),d=c.val(),s=o.gridStateToRequest(a),jQuery.ajax({url:i,async:!0,data:s+"&query_name="+encodeURIComponent(d),dataType:"json",success:function(e,t,n){return r(e,o.name,d,c)},type:"POST"}),t.preventDefault(),!1):void 0},r=function(r,n,i,o){var a,c,u,d,s;return d="#"+n+"_notification_messages",c="#"+n+"_title",s="#"+n+"_query_list",i&&o.val(""),(a=r.error_messages)?$(d).text(a):((u=r.notification_messages)&&$(d).text(u),i&&$(c).html("<h3>"+i+"</h3>"),$(s).replaceWith(r.query_list),jQuery.ui&&$(s).effect("highlight"),$(".wice-grid-delete-query",$(s)).click(function(t){return e(this,t)}),$(".wice-grid-query-load-link",$(s)).click(function(e){return t(this,e)}))}}.call(this);